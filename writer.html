<!DOCTYPE html>
<title id="$COMICNGWRITER$$$">Writer</title>
<script>
    var defer = !0,
        mainsrc = "http://comixngn.js.org/ghs/lab/comixngn.js",
        loadng = ["http://comixngn.js.org/ghs/1.1.1/plugins/comixngn.jq.js","http://code.jquery.com/jquery-2.1.4.min.js", "https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"],
        aftjq = ["http://code.jquery.com/ui/1.11.4/jquery-ui.min.js", "https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.7.0/spectrum.min.js"],
        fuse = {fstrun: true, pgepsh: false, pgesve: false, rtepge: false, protect: false, noverwrite: false},
        plugin = "",
        disable = ["rollbar"],
        comicID="CNGwriter",
        dir = "http://comixngn.js.org/",
        tir = "http://comixngn.js.org/",
        $GPC = $GPC + 1 || 1,
        cG={agent:function(e,t){return t=new XMLHttpRequest,t.open("GET",e),e=[],t.onreadystatechange=t.then=function(n,s,a){if(n&&n.call&&(e=[,n,s]),4==t.readyState&&(a=e[0|t.status/200]))try{a(JSON.parse(t.responseText),t)}catch(c){a(t.responseText,t)}},t.send(),t},REPO:{scReq:{address: "http://comixngn.js.org/"}},dis:{}};
</script>
<base href="/comic-ng/">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.6.1/spectrum.min.css">
<link rel="stylesheet" type="text/css" href="https://bootswatch.com/simplex/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/humane-js/3.2.2/themes/flatty.min.css" />

<body style="margin:4px; padding:4px">
    <h1>Writer</h1>
    <span id=MHEAD></span>
    <style>
        #nav-toolbar li {
            list-style-type: none;
            display: inline;
            margin: 0px;
            padding: 0px;
        }
    </style>
    <div id="nav-toolbar" style="border: 2px groove; position: fixed; left: 50%; z-index: 9;">
        <ul style="padding: 0px; margin: 0px; top: 50%;">
            <li><button id="nav-move"><span class="glyphicon glyphicon-move" aria-hidden="true" style="z-index:999;"></span></button></li>
            <!--<li><button id="nav-undo"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true" style="z-index:999;"></span></button></li>
            <li><button id="nav-redo"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true" style="z-index:999;"></span></button></li>-->
            <li>
                <select id="nav-select" data-mini="true" data-inline="true">
                    <option value="list">List</option>
                    <option value="thum">Thumbnail</option>
                    <!--<option value="express">Express: next day</option>
<option value="overnight">Overnight</option>-->
                </select>
            </li>
            <li><button id="_set">* Settings</button></li>
            <li><button id="ExBtnCL" title="Save Settings">Export</button></li>
            <li><span id=MHEADCL></span></li>
            <li><button id="_des">* Design</button></li>
        </ul>
    </div>
    <div id="accordion">
        <h3 class="button" role="button">* Settings</h3>
        <div id="settings_contain">
            <form onsubmit="return false;">
                <table id="bodtab" border="0" style="width:100%">
                    <tr>
                        <td colspan="2">
                            <h4 id="confhead" title="Click to toggle border">Configuration</h4>
                        </td>
                    </tr>
                    <tr>
                        <td title="Image directory">
                            <label for="dir">Directory</label>
                            <input value="assets/" id="dir" type="text">
                        </td>
                        <td title="Select this if you want to continue from a previous configuration.">
                            <label for="historian">Config File</label>
                            <input id="historian" type="file" accept=".json" style="display: inline;">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="psn_0">Page Start</label>
                            <input type="radio" id="psn_0" name="psb" checked>0&nbsp;
                            <input type="radio" id="psn_1" name="psb">1</td>
                        <td>
                            <label for="csn_0">Chapter Start</label>
                            <input type="radio" id="csn_0" name="csb" checked>0&nbsp;
                            <input type="radio" id="csn_1" name="csb">1</td>
                    </tr>
                    <tr>
                        <td title="How far behind images are preloaded">
                            <label for="prb">Pre-Buffer</label>
                            <input type="number" value=5 id="prb" min="1" max="100">
                        </td>
                        <td title="How far ahead images are preloaded">
                            <label for="ptb">Post-Buffer</label>
                            <input type="number" value=5 id="ptb" min="1" max="100">
                        </td>
                    </tr>
                    <tr>
                        <td title="An additive json is a file that allows pages to be added by url alone">
                            <label for="add_0">Additive pages</label>
                            <input type="radio" id="add_0" name="aad" checked>Disabled&nbsp;
                            <input type="radio" id="add_1" name="aad">Enabled</td>
                        <td title="Merge these additive into pages of the script">
                            <label for="mergeadd">Additive Merge</label>
                            <input id="mergeadd" type="file" accept=".json" style="display: inline;">
                        </td>
                    </tr>
                    <tr>
                        <td style="vertical-align:top" title="If there are more images in the directory than in +the configuration file, attempt to automatically add them">
                            <label for="pyr_0">Append on Page Mismatch</label>
                            <input type="radio" id="pyr_0" name="pyrt" checked>On&nbsp;
                            <input type="radio" id="pyr_1" name="pyrt">Off</td>
                        <td rowspan="2" style="vertical-align:top" title="The order in which the images should be appended">
                            <label for="spyr_0">Append Order</label>
                            <input type="radio" id="spyr_0" name="spyrt" checked>Modified&nbsp;
                            <input type="radio" id="spyr_1" name="spyrt">Name&nbsp;
                            <input type="radio" id="spyr_2" name="spyrt">Size&nbsp;
                            <input type="radio" id="spyr_3" name="spyrt">Type&nbsp;
                            <br>
                            <input type="radio" id="spyro_0" name="spyrto" checked>Descending&nbsp;
                            <input type="radio" id="spyro_1" name="spyrto">Ascending</td>
                    </tr>
                    <tr>
                        <td title="The page that the comic loads first, either start from the beginning or the most recent">
                            <label for="strp">Start Page</label>
                            <input type="number" id="strp" name="strp" min="0" value=0></td>
                    </tr>
                    <tr>
                        <td title="Background color of webcomic">
                            <label for="back_total">Background: </label>
                            <input id="back_color" style="visibility: hidden;"></td>
                        <td title="Order of navigation button: Left to Right or Right to Left">
                            <label for="rdr_0">Reading Direction</label>
                            <input type="radio" id="rdr_0" name="rdi" checked>L -> R&nbsp;
                            <input type="radio" id="rdr_1" name="rdi">R -> L</td>
                    </tr>
                    <tr>
                        <td colspan="8">
                            <div class="spoiler" data-spoiler-link="1">Loading Spinner</div>
                            <div class="spoiler-content" data-spoiler-link="1">
                                <table>
                                    <tr>
                                        <td>
                                            <label for="dia">Diameter</label> <input style="width:100px;" type="number" value=250 id="dia" min="1"></td>
                                        <td rowspan="8"><canvas id="custom_spin" class="center"></canvas></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="wid">Lines: </label> <input style="width:35px;" type="number" value=16 id="lin" min="1">
                                            <label for="rat">Rate(ms): </label> <input style="width:65px;" step="any" value=33.333333333333336 id="rat" min="1">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="xpose">X-pos</label> <input style="width:50px;" type="number" step="0.01" value=0.5 id="xpose" min="0" max="1">
                                            <label for="ypose">Y-pos</label> <input style="width:50px;" type="number" step="0.01" value=0.5 id="ypose" min="0" max="1">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="back_load">Background: </label>
                                            <input id="back_load">
                                            <label for="color_load">Color: </label>
                                            <input id="color_load">
                                        </td>
                                    </tr>
                                </table></div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h4 id="CHPHEAD">Chapters</h4>
                            <button id="add2">+</button>
                        </td>
                        <td>
                            <h4 id="PGEHEAD">Pages</h4>
                            <button id="add3">+</button><input id="conductor" type="file" multiple>
                        </td>
                    <tr>
                        <td style="vertical-align:top">
                            <ol id="Csort" class="empty"></ol>
                        </td>
                        <td style="vertical-align:top">
                            <ol id="sorted" class="empty"></ol>
                        </td>
                    </tr>
                </table>
                <input id="ExBtn" type="submit" value="Export" title="Save Settings">
            </form>
        </div>
        <h3 class="button" role="button">* Design</h3>
        <div id="design_contain"><!-- style="display: none;">-->
            <p>
                <!--<button id="InBtn" title="Create site template; this does not save settings it simply creates an index.html file">Site Template</button>&nbsp;
                <button id="DsBtn" title="Save Stage Design">Save Design</button>-->
            </p>
            <div id class="venue"></div>
        </div>
    </div>
</body>

<script>
    var expfunct,
        settingsC,
        settingsP,
        remveC,
        remveP,
        report,
        workhorse = function() {
            if (settingsC,
        settingsP,void 0 === window.jQuery || void 0 === window.jQuery.ui || void 0 === humane)
                return setTimeout(workhorse, 300);
            /*var jQ = jQuery.noConflict();*/
            console.log("%c %c %c comix-ngn Writer v" + cG.info.vwr + " %c \u262F %c \u00A9 2015 Oluwaseun Ogedengbe %c ", "color:white; background:#B5B5B5", "background:purple", "color:black; background:#E2E2E2", 'color:red; background:black', "color:black; background:#B5B5B5", "background:purple");
            var spin = {
                start: Date.now(),
                lines: 16,
                rate: 33.333333333333336,
                cwidth: 300,
                cheight: 150,
                diameter: 250,
                xpos: 0.5,
                ypos: 0.5,
                back: "#fff",
                color: "#373737",
                context: document.getElementById("custom_spin").getContext("2d")
            },
                fspin = function() {
                    $("#custom_spin").css("background",spin.back);
                    var rotation = Math.floor(((Date.now() - spin.start) / 1000) * spin.lines) / spin.lines,
                        c = spin.color.substr(1);
                    spin.context.save();
                    spin.context.clearRect(0, 0, spin.cwidth, spin.cheight);
                    spin.context.translate(spin.cwidth / 2, spin.cheight / 2);
                    spin.context.rotate(Math.PI * 2 * rotation);
                    if (c.length == 3) c = c[0] + C[0] + c[1] + c[1] + c[2] + c[2];
                    var red = parseInt(c.substr(0, 2), 16).toString(),
                        green = parseInt(c.substr(2, 2), 16).toString(),
                        blue = parseInt(c.substr(4, 2), 16).toString();
                    for (var i = 0; i < spin.lines; i++) {
                        spin.context.beginPath();
                        spin.context.rotate(Math.PI * 2 / spin.lines);
                        spin.context.moveTo(spin.diameter / 10, 0);
                        spin.context.lineTo(spin.diameter / 4, 0);
                        spin.context.lineWidth = spin.diameter / 30;
                        spin.context.strokeStyle = "rgba(" + red + "," + green + "," + blue + "," + i / spin.lines + ")";
                        spin.context.stroke();
                    }
                    spin.context.restore();
                    /*console.log(spin.rate)*/
                    window.setTimeout(fspin, spin.rate);
                }
            $("#CHPHEAD").data({});
            $("#confhead").click(function() {
                if ($("#bodtab").attr("border") == "1") {
                    $("#bodtab").attr("border", "0");
                } else {
                    $("#bodtab").attr("border", "1");
                }
            });
            $("#accordion").accordion({
                collapsible: true,
                heightStyle: "content"
            });
            /*.sortable({
                        axis: "y",
                        handle: "h3",
                        stop: function( event, ui ) {
                          // IE doesn't register the blur when sorting
                          // so trigger focusout handlers to remove .ui-state-focus
                          ui.item.children( "h3" ).triggerHandler( "focusout" );

                          // Refresh accordion to handle new order
                          $( this ).accordion( "refresh" );
                        }
                      });*/
            $.data($("#back_color"),"color","#fff");
            $("#back_color").spectrum({
                color: "#fff",
                change: function(color) {
                    $.data($("#back_color"),"color",color.toHexString());
                }
            }).css("visibility", "visible" );
            $("#color_load").spectrum({
                color: "#373737",
                change: function(color){
                    spin.color = color.toHexString();
                }
            });
            $("#back_load").spectrum({
                color: "#fff",
                change: function(color){
                    spin.back = color.toHexString(); 
                }
            });
            $(".spoiler").spoiler();
            window.setTimeout(fspin, spin.rate);
            var spinsetchange = function(){
                spin.lines = $("#lin").val();
                spin.rate = jaz.resolveRPN(jaz.shuntingYard($("#rat").val()));
                $("#rat").val(spin.rate);
                spin.diameter = $("#dia").val();
                spin.xpos = $("#xpose").val();
                spin.ypos = $("#ypose").val();
            }
            $("#lin").change(spinsetchange);
            $("#rat").change(spinsetchange);
            $("#dia").change(spinsetchange);
            $("#xpose").change(spinsetchange);
            $("#ypose").change(spinsetchange);
            $("#back_load").change(spinsetchange);
            $("#color_load").change(spinsetchange);
            /*
        $(".spoiler-content").show();
        $("#design_contain").show();*/
            $("#add3").click(function() {
                if ($("#sorted").hasClass("empty")) {
                    $("#sorted").removeClass("empty");
                }
                cG.comix.internals.pages.push({alt:"",hover:"",title:"",url:[],release:0,note:"",perm:!1,anim8:!1});
                var yun = ($("#nav-select").val()=="list")?'':"<img style='max-width:64px;max-height:64px;'>";
                var i = $("#sorted").get(0).childElementCount;
                //console.log(i);
                $("#sorted").append("<li id=s" + i + "><span class=page_icon id=name_s" + i + ">" + yun + "</span>" + " <button onClick=settingsP('#s" + i + "');>&#x2731</button><button onClick=remveP('#s" + i + "')>X</button></li>").sortable({
                        scroll: true
                    });
                    $("#s" + i).data({
                        open: false,
                        body: {
                            alt: "",
                            hover: "",
                            title: "",
                            url: [],
                            release: 0,
                            note: "",
                            perm: false,
                            anim8: false,
                            special: "",
                        }
                    }).addClass("page");
            });
            $("#add2").click(function() {
                if ($("#Csort").hasClass("empty")) {
                    $("#Csort").removeClass("empty");
                }
                var oper = $("#Csort").childElementCount;
                $("#Csort").append("<li id=c" + oper + ">" + "Chapter" + " <button onClick=settingsC('#c" + oper + "')>&#x2731</button><button onClick=remveC('#c" + oper + "')>X</button> </li>").sortable({
                    scroll: true
                });
                $("#c" + oper).data({
                    open: false,
                    body: {
                        description: "",
                        end: 0,
                        start: 0,
                        title: "Chapter",
                    }
                }).addClass("chap");
            });
            $("#nav-select").change(function() {
                var src = $(".page");
                var ico = $(".page_icon");
                //console.log($("#"+src[0].id).data().body.title);
                if($("#nav-select").val()=="list"){
                    for(var i=0;i<src.length;i++){
                        $("#"+ico[i].id).html($("#"+src[i].id).data().body.url);
                    }
                } else {
                    for(var i=0;i<src.length;i++){
                        $("#"+ico[i].id).html("<img style='max-width:64px;max-height:64px;' src='"+cG.script.config.dir+$("#"+src[i].id).data().body.url+"'>");
                    }
                }
            });
            $("#conductor").change(function() {
                if ($("#sorted").hasClass("empty")) {
                    $("#sorted").removeClass("empty");
                }
                console.log(this.files);
                /*$("#sorted").innerHTML ="";*/
                var yun;
                for (var i = 0; i < this.files.length; i++) {
                    yun = ($("#nav-select").val()=="list")?this.files[i].name:"<img style='max-width:64px;max-height:64px;' src='" + this.files[i].name + "'>";
                    $("#sorted").append("<li id=s" + i + "><span class=page_icon id=name_s" + i + ">" + yun + "</span>" + " <button onClick=settingsP('#s" + i + "');>&#x2731</button><button onClick=remveP('#s" + i + "')>X</button></li>").sortable({
                        scroll: true
                    });
                    $("#s" + i).data({
                        open: false,
                        body: {
                            alt: "",
                            hover: "",
                            title: "",
                            url: [this.files[i].name],
                            release: 0,
                            note: "",
                            perm: false,
                            anim8: false,
                            special: "",
                        }
                    }).addClass("page");
                }
            });
            $("#mergeadd").change(function() {
                delete window.confirm;
                if ((!$("#Csort").hasClass("empty") || !$("#sorted").hasClass("empty")) && !confirm("This will add pages, are you sure?")) {
                    this.files = {};
                    return;
                }
                console.log(this.files);
                if (!this.files.length) return;

                /*if (!this.files[0].type.match()) {
                    throw "File Type must be an image";
                }*/

                // Using FileReader to display the image content
                var reader = new FileReader();
                reader.onload = function(e) {
                    cG.addRender(JSON.parse(e.target.result));
                    report(cG.script);
                    //console.log(cG.script);
                    $(".venue").stageInjection();
                };
                reader.readAsText(this.files[0]);
                /*$.getJSON(this.files[0].name, function(conf) {
                    report(conf);
                });*/
            });
            $("#historian").change(function() {
                delete window.confirm;
                if ((!$("#Csort").hasClass("empty") || !$("#sorted").hasClass("empty")) && !confirm("This will overwrite your current configuration, are you sure?")) {
                    this.files = {};
                    return;
                }
                console.log(this.files);
                if (!this.files.length) return;
                /*$("#sorted").innerHTML ="";*/
                $("#sorted").textContent = "";
                $("#Csort").textContent = "";

                /*if (!this.files[0].type.match()) {
                    throw "File Type must be an image";
                }*/

                // Using FileReader to display the image content
                var reader = new FileReader();
                reader.onload = function(e) {
                    cG.script = JSON.parse(e.target.result);
                    report(cG.script);
                    //console.log(cG.script);
                    $(".venue").stageInjection();
                };
                reader.readAsText(this.files[0]);
                /*$.getJSON(this.files[0].name, function(conf) {
                    report(conf);
                });*/
            });
            movingtoolbar=false;
            $(document.body).mousemove(function() {
                if(!movingtoolbar) return 0;
                event.preventDefault();
                $("#nav-toolbar").offset({top: event.pageY-10,left: event.pageX-10});
            });
            $("#nav-move").click(function() {
                //console.log("nav-move");
                if(movingtoolbar) movingtoolbar=false;
                else movingtoolbar=true;
                //event.preventDefault();
            });
            $("#_set").click(function() {
                $("#settings_contain").slideToggle();
            });
            $("#_des").click(function() {
                $("#design_contain").slideToggle();
            });
            $("#ExBtn").click(function(){return expfunct()});
            $("#ExBtnCL").click(function(){return expfunct()});
            expfunct = function() {
                var setOBJ = {
                    parent: null,
                    offset: 0,
                    config: {},
                    pyr: {},
                    loading: {},
                    chapters: [],
                    pages: []
                };
                /*delete window.alert;
                    alert("Settings Configured!");*/
                setOBJ.config.dir = $("#dir").val();
                    setOBJ.config.pagestartnum = document.getElementById("psn_1").checked;
                    setOBJ.config.readdir = document.getElementById("rdr_1").checked;
                    setOBJ.config.additive = document.getElementById("add_1").checked;
                    setOBJ.config.chapterstartnum = document.getElementById("csn_1").checked;
                setOBJ.config.startpage = parseInt($("#strp").val(),10);/*document.getElementById("strp_1").checked;*/
                setOBJ.config.imgprebuffer = parseInt($("#prb").val(),10);
                setOBJ.config.imgpostbuffer = parseInt($("#ptb").val(),10);
                setOBJ.config.back = $.data($("#ptb"),"color");
                setOBJ.pyr.appendmismatch = document.getElementById("pyr_0").checked;
                if (document.getElementById("spyr_0").checked) {
                    setOBJ.pyr.appendorder = 0;
                } else if (document.getElementById("spyr_1").checked) {
                    setOBJ.pyr.appendorder = 1;
                } else if (document.getElementById("spyr_2").checked) {
                    setOBJ.pyr.appendorder = 2;
                } else if (document.getElementById("spyr_3").checked) {
                    setOBJ.pyr.appendorder = 3;
                }
                setOBJ.pyr.appendorderdir = document.getElementById("spyro_0").checked;
                setOBJ.loading.diameter = spin.diameter;
                setOBJ.loading.lines = spin.lines;
                setOBJ.loading.rate = spin.rate;
                setOBJ.loading.xpos = spin.xpos;
                setOBJ.loading.ypos = spin.ypos;
                setOBJ.loading.back = spin.back;
                setOBJ.loading.color = spin.color;
                for (j = 0; j < document.getElementById("Csort").childElementCount; j++) {
                    setOBJ.chapters.push($(".class,li").eq(j).data().body);
                }
                for (j = 0; j < document.getElementById("sorted").childElementCount; j++) {
                    setOBJ.pages.push($(".page"/*,li"*/).eq(j).data().body);
                }
                console.log(setOBJ);
                $('.setlink').remove();
                var refh = "<a onClick=$('.setlink').remove() class='setlink' href='data: text/json;charset=utf-8," + JSON.stringify(setOBJ, ["parent","offset","config", "pyr", "loading", "pages", "chapters", "dir", "startpage", "pagestartnum", "readdir" , "additive", "chapterstartnum", "imgprebuffer", "imgpostbuffer", "back", "appendmismatch", "appendorder", "appendorderdir", "alt", "hover", "title","perm","anim8","special", "url", "release", "note", "description", "start", "end", "title", "diameter","lines","rate","xpos","ypos","back","color"]) + "' download='config.json' autofocus>config.json<br></a>",
                    formref = "<a onClick=$('.setlink').remove() class='setlink' href='data: text/json;charset=utf-8," + JSON.stringify(setOBJ, ["parent","offset","config", "pyr", "loading", "pages", "chapters", "dir", "startpage", "pagestartnum", "readdir", "additive", "chapterstartnum", "imgprebuffer", "imgpostbuffer", "back", "appendmismatch", "appendorder", "appendorderdir", "alt", "hover", "title","perm","anim8","special", "url", "release", "note", "description", "start", "end", "title", "diameter","lines","rate","xpos","ypos","back","color"],4) + "' download='config.json' autofocus>config.json<br></a>";
                console.log(formref);
                $(refh).appendTo("#MHEAD");
                $(refh).appendTo("#MHEADCL");
            };
            $("#InBtn").click(function() {
                $('#indlink').remove();
                var refh = "";
                console.log(refh);
                $(refh).appendTo("#MHEAD");
            });
            $("#DsBtn").click(function() {
                $('#deslink').remove(); /*temporary, using predefined scene*/
                var refh = "OUTDATED";
                console.log(refh);
                $(refh).appendTo("#MHEAD");
            });
            settingsP = function(ele) {
                var lee = ele.substring(1);
                console.log(ele);
                console.log($(ele).data().open);
                if (typeof $(ele).data().body.perm === 'undefined') {
                    $(ele).data().body.perm = false;
                }
                if ($(ele).data().open) {
                    console.log("deleting");
                    $(ele).data().body.title = $("#TEMP_title" + lee).val();
                    $(ele).data().body.hover = $("#TEMP_hover" + lee).val();
                    $(ele).data().body.note = $("#TEMP_note" + lee).val();
                    $(ele).data().body.alt = $("#TEMP_alt" + lee).val();
                    $(ele).data().body.release = $("#TEMP_release" + lee).val();
                    var ent = $("#TEMP_url" + lee).val();
                    $(ele).data().body.url = ent;
                    $("#name_" + lee).html(($("#nav-select").val()=="list")?ent:"<img style='max-width:64px;max-height:64px;' src='"+cG.script.config.dir+ent+"'>");
                    $(ele).data().body.perm = document.getElementById("TEMP_perm" + lee).checked;
                    $(ele).data().body.anim8 = document.getElementById("TEMP_anim8" + lee).checked;
                    $(ele).data().body.special = $("#TEMP_special" + lee).val();
                    //virtual changes
                    console.log(ele,$(ele).data());
                    var vrt = parseInt(ele.substring(2),10);
                    cG.comix.internals.pages[vrt].title=$(ele).data().body.title;
                    cG.comix.internals.pages[vrt].hover=$(ele).data().body.hover;
                    cG.comix.internals.pages[vrt].note=$(ele).data().body.note;
                    cG.comix.internals.pages[vrt].alt=$(ele).data().body.alt;
                    cG.comix.internals.pages[vrt].release=$(ele).data().body.release;
                    cG.comix.internals.pages[vrt].url=$(ele).data().body.url;
                    cG.comix.internals.pages[vrt].perm=$(ele).data().body.perm;
                    cG.comix.internals.pages[vrt].anim8=$(ele).data().body.anim8;
                    cG.comix.internals.pages[vrt].special=$(ele).data().body.special;
                    switch(vrt) {
                        case 0:
                            cG.comix.internals.pages[vrt].desig=-1
                            break;
                        case cG.comix.internals.pages.length-1:
                            cG.comix.internals.pages[vrt].desig=1;
                            break;
                        default:
                            cG.comix.internals.pages[vrt].desig=0;
                    }
                    cG.comix.internals.pages[vrt].loaded = false;
                    console.log(lee);
                    $("#TEMPFORM_" + lee).remove();
                    /*document.getElementById(ele.substring(1)).removeChild(document.getElementById("TEMPFORM_"+ele));fallback*/
                    $(ele).focus();
                    $(ele).data().open = false;
                    console.log($(ele).data());
                } else {
                    var ischek = "",
                        ischex = "";
                    if ($(ele).data().body.perm) ischek = "checked";
                    if ($(ele).data().body.anim8) ischex = "checked";
                    $(ele).append("<form id='TEMPFORM_" + lee + "' autofocus><label for='TEMP_title" + lee + "'>Title&nbsp</label><input value='" + $(ele).data().body.title + "' id='TEMP_title" + lee + "' type='text' autofocus><br><label for='TEMP_hover" + lee + "'>Hover&nbsp</label><input value='" + $(ele).data().body.hover + "' id='TEMP_hover" + lee + "' type='text' title='Text on Mouse Over'><br><label for='TEMP_note" + lee + "'>Image Info&nbsp</label><input value='" + $(ele).data().body.note + "' id='TEMP_note" + lee + "' type='text'><br><label for='TEMP_alt" + lee + "'>Alt Text&nbsp</label><input value='" + $(ele).data().body.alt + "' id='TEMP_alt" + lee + "' type='text' title='If the image fails to load this text is loaded instead'><br><label for='TEMP_release" + lee + "'>Release Date&nbsp </label><input value='" + $(ele).data().body.release + "' id='TEMP_release" + lee + "' type='number' title='When should this slide be avaliable'><br><label for='TEMP_url" + lee + "'>URL&nbsp</label><input value='" + $(ele).data().body.url + "' id='TEMP_url" + lee + "' type='text' title='Filename of the image'><br><label for='TEMP_perm" + lee + "'>Permanent&nbsp</label><input " + ischek + " id='TEMP_perm" + lee + "' type='checkbox' title='Whether the image should always be loaded'><br><label for='TEMP_anim8" + lee + "'>Animate&nbsp</label><input " + ischex + " id='TEMP_anim8" + lee + "' type='checkbox' title='Whether the image/slide is animated'><br><label for='TEMP_special" + lee + "'>Special Code:&nbsp</label><textarea rows='4' cols='50' id='TEMP_perm" + lee + "'title='If the slide is not a static image, video/object/embed, put the code to render it here'></textarea><br></form>");
                    $(ele).focus();
                    $(ele).data().open = true;
                }
                return true;
            };
            settingsC = function(ele) {
                var lee = ele.substring(1);
                console.log(ele);
                console.log($(ele).data().open);
                if ($(ele).data().open) {
                    $(ele).data().body.description = $("#TEMP_description" + lee).val();
                    $(ele).data().body.end = $("#TEMP_end" + lee).val();
                    $(ele).data().body.start = $("#TEMP_start" + lee).val();
                    var ent = $("#TEMP_title" + lee).val()
                    $(ele).data().body.title = ent;
                    $("#name_" + lee).html(ent);
                    //virtual changes
                    var vrt = parseInt(ele.substring(2),10);
                    cG.comix.internals.chapters[vrt].title=$(ele).data().body.title;
                    cG.comix.internals.chapters[vrt].description=$(ele).data().body.description;
                    cG.comix.internals.chapters[vrt].end=$(ele).data().body.end;
                    cG.comix.internals.chapters[vrt].start=$(ele).data().body.start;
                    //
                    $("#TEMPFORM_" + lee).remove();

                    $(ele).focus();
                    $(ele).data().open = false;
                    console.log($(ele).data());
                } else {
                    $(ele).append("<form id='TEMPFORM_" + lee + "' autofocus><label for='TEMP_title" + lee + "'>Title&nbsp</label><input value='" + $(ele).data().body.title + "' id='TEMP_title" + lee + "' type='text' autofocus><br><label for='TEMP_description" + lee + "'>Description&nbsp</label><input value='" + $(ele).data().body.description + "' id='TEMP_description" + lee + "' type='text' title='Chapter description'><br><label for='TEMP_start" + lee + "'>Start&nbsp</label><input value='" + $(ele).data().body.start + "' id='TEMP_start" + lee + "' type='text' title='Starting page ID value'><br><label for='TEMP_end" + lee + "'>End&nbsp</label><input value='" + $(ele).data().body.end + "' id='TEMP_end" + lee + "' type='text' title='Ending page ID value'><br></form>");
                    $(ele).focus();
                    $(ele).data().open = true;
                }
                return true;
            };
            remveP = function(ele) {
                $(ele).remove();
                cG.comix.internals.pages.splice(ele.substring(2), 1);
            };
            remveC = function(ele) {
                $(ele).remove(); cG.comix.internals.chapters.splice(ele.substring(2), 1);
            };
            report = function(conf) {
                console.log(conf);
                document.getElementById("psn_0").checked = false;
                document.getElementById("psn_1").checked = false;
                document.getElementById("rdr_0").checked = false;
                document.getElementById("rdr_1").checked = false;
                document.getElementById("add_0").checked = false;
                document.getElementById("add_1").checked = false;
                document.getElementById("csn_0").checked = false;
                document.getElementById("csn_1").checked = false;
                /*document.getElementById("strp_0").checked = false;
            document.getElementById("strp_1").checked = false;*/
                document.getElementById("pyr_0").checked = false;
                document.getElementById("pyr_1").checked = false;
                document.getElementById("spyr_0").checked = false;
                document.getElementById("spyr_1").checked = false;
                document.getElementById("spyr_2").checked = false;
                document.getElementById("spyr_3").checked = false;  
                document.getElementById("spyro_0").checked = false;
                document.getElementById("spyro_1").checked = false;

                if (typeof conf.config === 'undefined') { /*config module dependency*/
                    /*default settings*/
                    $("#dir").val("assets/");
                    $("#prb").val("5");
                    $("#strp").val("0");
                    $.data($("#back_color"),"color","#fff"); 
                    document.getElementById("rdr_1").checked = true; 
                    document.getElementById("add_1").checked = true; 
                    document.getElementById("psn_1").checked = true;
                    document.getElementById("csn_1").checked = true;
                } else {
                    $("#dir").val(conf.config.dir);
                    $("#prb").val(conf.config.imgprebuffer);
                    $("#ptb").val(conf.config.imgpostbuffer);
                    if (typeof conf.config.startpage === 'undefined') {
                        $("#strp").val("0");
                    } else if (conf.config.startpage) {
                        $("#strp").val(conf.config.startpage);
                    }
                    if (typeof conf.config.back === 'undefined') {
                        $.data($("#back_color"),"color","#fff"); 
                    } else if (conf.config.back) {
                        $.data($("#back_color"),"color","#fff");
                        $("#back_color").spectrum.color = conf.config.back;/*I DONT EVEN KNOW IF THIS WILL WORK, BUT FCK IT*/
                    }
                    if (conf.config.pagestartnum) document.getElementById("psn_1").checked = true;
                    else document.getElementById("psn_0").checked = true;
                    if (conf.config.readdir) document.getElementById("rdr_1").checked = true;
                    else document.getElementById("rdr_0").checked = true;
                    if (conf.config.additive) document.getElementById("add_1").checked = true;
                    else document.getElementById("add_0").checked = true;
                    if (conf.config.chapterstartnum) document.getElementById("csn_1").checked = true;
                    else document.getElementById("csn_0").checked = true;
                }
                if (typeof conf.pyr === 'undefined') { /*pyr module dependency*/
                    /*default settings*/
                    document.getElementById("pyr_0").checked = true;
                    document.getElementById("spyr_0").checked = true;
                    document.getElementById("spyro_0").checked = true;
                } else {
                    if (conf.pyr.appendmismatch) {
                        document.getElementById("pyr_0").checked = true;
                    } else {
                        document.getElementById("pyr_1").checked = true;
                    }
                    if (!conf.pyr.appendorder) {
                        document.getElementById("spyr_0").checked = true;
                    } else if (conf.pyr.appendorder == 1) {
                        document.getElementById("spyr_1").checked = true;
                    } else if (conf.pyr.appendorder == 2) {
                        document.getElementById("spyr_2").checked = true;
                    } else if (conf.pyr.appendorder == 3) {
                        document.getElementById("spyr_3").checked = true;
                    }
                    if (conf.pyr.appendorderdir) {
                        document.getElementById("spyro_0").checked = true;
                    } else {
                        document.getElementById("spyro_1").checked = true;
                    }
                }
                if (typeof conf.loading === 'undefined') { /*loading module dependency*/
                    /*default settings*/
                    $("#lin").val(16);
                    $("#rat").val(33.333333333333336);
                    $("#dia").val(250);
                    $("#xpose").val(0.5);
                    $("#ypose").val(0.5);
                    $("#back_load").spectrum.color="#fff";
                    $("#color_load").spectrum.color="#373737";
                } else {
                    $("#lin").val(conf.loading.lines);
                    $("#rat").val(conf.loading.rate);
                    $("#dia").val(conf.loading.diameter);
                    $("#xpose").val(conf.loading.xpos);
                    $("#ypose").val(conf.loading.ypos);
                    $("#back_load").spectrum.color=conf.loading.back;
                    $("#color_load").spectrum.color=conf.loading.color;
                }
                var fillin;
                for (var i = 0; i < conf.pages.length; i++) {
                    fillin = ($("#nav-select").val()=="list")?conf.pages[i].url:"<img style='max-width:64px;max-height:64px;' src='" + cG.script.config.dir+conf.pages[i].url + "'>";
                    $("#sorted").append("<li id=s" + i + "><span class=page_icon id=name_s" + i + ">" + fillin + "</span> <button onClick=settingsP('#s" + i + "');>&#x2731</button><button onClick=remveP('#s" + i + "')>X</button></li>").sortable({
                        scroll: true
                    });
                    if (typeof conf.pages[i].perm === 'undefined') {
                        conf.pages[i].perm = false;
                    }
                    $("#s" + i).data({
                        open: false,
                        body: {
                            alt: conf.pages[i].alt,
                            hover: conf.pages[i].hover,
                            title: conf.pages[i].title,
                            url: (Array.isArray(conf.pages[i].url))?conf.pages[i].url:[conf.pages[i].url],
                            release: conf.pages[i].release,
                            note: conf.pages[i].note,
                            perm: conf.pages[i].perm,
                            anim8: (conf.pages[i].anim8===void 0)?false:conf.pages[i].anim8,
                            special: (conf.pages[i].special===void 0)?"":conf.pages[i].special
                        }
                    }).addClass("page");
                }
                for (var oper = 0; oper < conf.chapters.length; oper++) {
                    //console.log(i);
                    $("#Csort").append("<li id=c" + oper + "><span id=name_c" + oper + ">" + conf.chapters[oper].title + "</span> <button onClick=settingsC('#c" + oper + "')>&#x2731</button><button onClick=remveC('#c" + oper + "')>X</button> </li>").sortable({
                        scroll: true
                    });
                    $("#c" + oper).data({
                        open: false,
                        body: {
                            description: conf.chapters[oper].description,
                            end: conf.chapters[oper].end,
                            start: conf.chapters[oper].start,
                            title: conf.chapters[oper].title,
                        }
                    }).addClass("chap");
                }
            };
        },
        dfr=function(){/*!
     * Implementation of the Shunting yard algorithm
     * look it up: http://en.wikipedia.org/wiki/Shunting-yard_algorithm
     *
     * Copyright 2013, Georg Tavonius
     * Licensed under the MIT license.
     *
     * @version 1.0.1
     *
     * @author Georg Tavonius a.k.a. Calamari (http://github.com/Calamari)
     * @homepage http://github.com/Calamari/shunting-yard.js
     */!function(e){"use strict";function t(e,t,n,r,i){return n=n||"left",{name:e,precedence:t,params:r,method:i,greaterThen:function(e){return t>e.precedence},greaterThenEqual:function(e){return t>=e.precedence},equalThen:function(e){return t===e.precedence},lessThen:function(e){return t<e.precedence},lessThenEqual:function(e){return t<=e.precedence},leftAssoc:function(){return"left"===n},rightAssoc:function(){return"right"===n}}}function n(e,t,n){return{name:e,params:t,method:n}}var r=window.jaz||{};r.shuntingYard=function(t){function n(e){return"("===e}function i(e){return")"===e}function s(e){return r.Operators[e]}function c(e){return r.Functions[e]}var o,a,d,l,u,f,h,p=[],v=[];for(d=0,l=t.length;l>d;++d)if(u=t[d]," "!==u){if(a&&(u=a+=u,a=null),n(u))v.push(u);else if(c(u))v.push(u);else if(i(u)){for(;(f=v.pop())&&!n(f);)c(f)||p.push(f);if(f===e)return null}else if(s(u)){if(!o||"("===o){a=u;continue}for(;v.length&&(h=r.Operators[u],f=r.Operators[v[v.length-1]],f&&h)&&(h.leftAssoc()&&h.lessThenEqual(f)||h.lessThen(f));)p.push(v.pop());v.push(u)}else!o||n(o)||s(o)?p.push(u):p[p.length-1]+=u;o=u}for(;v.length;){if(u=v.pop(),n(u))return null;p.push(u)}return p},r.Operator=t,r.Operators={"+":new t("+",2,"left",2,function(e,t){return e+t}),"-":new t("-",2,"left",2,function(e,t){return e-t}),"*":new t("*",3,"left",2,function(e,t){return e*t}),"/":new t("/",3,"left",2,function(e,t){return e/t}),"^":new t("^",4,"right",2,function(e,t){return Math.pow(e,t)})},r.Function=n,r.Functions={},window.jaz=r}(),/*!
     * Resolves a RPN
     *
     * Copyright 2013, Georg Tavonius
     * Licensed under the MIT license.
     *
     * @author Georg Tavonius a.k.a. Calamari (http://github.com/Calamari)
     * @homepage http://github.com/Calamari/shunting-yard.js
     */!function(){"use strict";var e=window.jaz||{};e.resolveRPN=function(t){function n(t){return e.Operators[t]||e.Functions[t]}var r,i,s,c=[];for(r=0,i=t.length;i>r;++r)s=n(t[r]),c.push(s?s.method.apply(this,c.splice(-s.params)):parseFloat(t[r]));return c[0]},window.jaz=e}();var e=document.createElement("script");cG.REPO.scReq.getScript=cG.agent(dir+"script.json"),cG.REPO.scReq.getDecor=cG.agent(tir+"decor.html"),cG.REPO.scReq.getCtrls=cG.agent(tir+"ctrls.html"),cG.REPO.scReq.getScript.then(function(e){void 0===cG.REPO.script?cG.REPO.script={def:e}:cG.REPO.script.def=e,cG.script=cG.REPO.script.def},function(e,t){console.error(e,t.status),void 0===cG.REPO.script?cG.REPO.script={def:0}:cG.REPO.script.def=e,cG.script=cG.REPO.script.def}),cG.REPO.scReq.getDecor.then(function(e){void 0===cG.REPO.decor?cG.REPO.decor={def:e}:cG.REPO.decor.def=e,cG.decor=cG.REPO.decor.def},function(e,t){console.error(e,t.status),void 0===cG.REPO.decor?cG.REPO.decor={def:0}:cG.REPO.decor.def=0,cG.decor=cG.REPO.decor.def}),cG.REPO.scReq.getCtrls.then(function(e){void 0===cG.REPO.ctrls?cG.REPO.ctrls={def:e}:cG.REPO.ctrls.def=e,cG.ctrls=cG.REPO.ctrls.def},function(e,t){console.error(e,t.status),void 0===cG.REPO.ctrls?cG.REPO.ctrls={def:0}:cG.REPO.ctrls.def=0,cG.ctrls=cG.REPO.ctrls.def}),cG.comicID=comicID,cG.fBox=fuse;for(var t=0;t<disable.length;t++)cG.dis[disable[t]]=!0;e.src=mainsrc,document.body.appendChild(e);for(var n=0;n<loadng.length;n++)e=document.createElement("script"),e.src=loadng[n],document.body.appendChild(e);jqdep(),/*! humane.js: wavded.github.com/humane-js/ (MIT) (c) Marc Harter (@wavded)*/!function(e,t,n){"undefined"!=typeof module?module.exports=n(e,t):"function"==typeof define&&"object"==typeof define.amd?define(n):t[e]=n(e,t)}("humane",this,function(){var e=window,t=document,n={on:function(t,n,r){"addEventListener"in e?t.addEventListener(n,r,!1):t.attachEvent("on"+n,r)},off:function(t,n,r){"removeEventListener"in e?t.removeEventListener(n,r,!1):t.detachEvent("on"+n,r)},bind:function(e,t){return function(){e.apply(t,arguments)}},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},config:function(e,t){return null!=e?e:t},transSupport:!1,useFilter:/msie [678]/i.test(navigator.userAgent),_checkTransition:function(){var e=t.createElement("div"),n={webkit:"webkit",Moz:"",O:"o",ms:"MS"};for(var r in n)r+"Transition"in e.style&&(this.vendorPrefix=n[r],this.transSupport=!0)}};n._checkTransition();var r=function(t){t||(t={}),this.queue=[],this.baseCls=t.baseCls||"humane",this.addnCls=t.addnCls||"",this.timeout="timeout"in t?t.timeout:2500,this.waitForMove=t.waitForMove||!1,this.clickToClose=t.clickToClose||!1,this.timeoutAfterMove=t.timeoutAfterMove||!1,this.container=t.container;try{this._setupEl()}catch(r){n.on(e,"load",n.bind(this._setupEl,this))}};return r.prototype={constructor:r,_setupEl:function(){var e=t.createElement("div");if(e.style.display="none",!this.container){if(!t.body)throw"document.body is null";this.container=t.body}this.container.appendChild(e),this.el=e,this.removeEvent=n.bind(function(){var e=n.config(this.currentMsg.timeoutAfterMove,this.timeoutAfterMove);e?setTimeout(n.bind(this.remove,this),e):this.remove()},this),this.transEvent=n.bind(this._afterAnimation,this),this._run()},_afterTimeout:function(){n.config(this.currentMsg.waitForMove,this.waitForMove)?this.removeEventsSet||(n.on(t.body,"mousemove",this.removeEvent),n.on(t.body,"click",this.removeEvent),n.on(t.body,"keypress",this.removeEvent),n.on(t.body,"touchstart",this.removeEvent),this.removeEventsSet=!0):this.remove()},_run:function(){if(!this._animating&&this.queue.length&&this.el){this._animating=!0,this.currentTimer&&(clearTimeout(this.currentTimer),this.currentTimer=null);var e=this.queue.shift(),t=n.config(e.clickToClose,this.clickToClose);t&&(n.on(this.el,"click",this.removeEvent),n.on(this.el,"touchstart",this.removeEvent));var r=n.config(e.timeout,this.timeout);r>0&&(this.currentTimer=setTimeout(n.bind(this._afterTimeout,this),r)),n.isArray(e.html)&&(e.html="<ul><li>"+e.html.join("<li>")+"</ul>"),this.el.innerHTML=e.html,this.currentMsg=e,this.el.className=this.baseCls,n.transSupport?(this.el.style.display="block",setTimeout(n.bind(this._showMsg,this),50)):this._showMsg()}},_setOpacity:function(e){if(n.useFilter)try{this.el.filters.item("DXImageTransform.Microsoft.Alpha").Opacity=100*e}catch(t){}else this.el.style.opacity=e+""},_showMsg:function(){var e=n.config(this.currentMsg.addnCls,this.addnCls);if(n.transSupport)this.el.className=this.baseCls+" "+e+" "+this.baseCls+"-animate";else{var t=0;this.el.className=this.baseCls+" "+e+" "+this.baseCls+"-js-animate",this._setOpacity(0),this.el.style.display="block";var r=this,i=setInterval(function(){1>t?(t+=.1,t>1&&(t=1),r._setOpacity(t)):clearInterval(i)},30)}},_hideMsg:function(){var e=n.config(this.currentMsg.addnCls,this.addnCls);if(n.transSupport)this.el.className=this.baseCls+" "+e,n.on(this.el,n.vendorPrefix?n.vendorPrefix+"TransitionEnd":"transitionend",this.transEvent);else var t=1,r=this,i=setInterval(function(){t>0?(t-=.1,0>t&&(t=0),r._setOpacity(t)):(r.el.className=r.baseCls+" "+e,clearInterval(i),r._afterAnimation())},30)},_afterAnimation:function(){n.transSupport&&n.off(this.el,n.vendorPrefix?n.vendorPrefix+"TransitionEnd":"transitionend",this.transEvent),this.currentMsg.cb&&this.currentMsg.cb(),this.el.style.display="none",this._animating=!1,this._run()},remove:function(e){var r="function"==typeof e?e:null;n.off(t.body,"mousemove",this.removeEvent),n.off(t.body,"click",this.removeEvent),n.off(t.body,"keypress",this.removeEvent),n.off(t.body,"touchstart",this.removeEvent),n.off(this.el,"click",this.removeEvent),n.off(this.el,"touchstart",this.removeEvent),this.removeEventsSet=!1,r&&this.currentMsg&&(this.currentMsg.cb=r),this._animating?this._hideMsg():r&&r()},log:function(e,t,n,r){var i={};if(r)for(var s in r)i[s]=r[s];if("function"==typeof t)n=t;else if(t)for(var s in t)i[s]=t[s];return i.html=e,n&&(i.cb=n),this.queue.push(i),this._run(),this},spawn:function(e){var t=this;return function(n,r,i){return t.log.call(t,n,r,i,e),t}},create:function(e){return new r(e)}},new r})},jqdep=function(){if(void 0===window.jQuery)return setTimeout(jqdep,300);var e;/*! jquery-spoiler v1.3.0: (MIT) (c)2014 Triangle717 (http://le717.github.io) and Jarred Ballard (http://jarred.io/)*/!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){"use strict";e.fn.spoiler=function(t){var n=e.extend({contentClass:"spoiler-content",paddingValue:6,triggerEvents:!1,includePadding:!0,buttonActiveClass:"spoiler-active",spoilerVisibleClass:"spoiler-content-visible"},t),r="."+n.contentClass,i={};return e(r).each(function(){var t=e(this);t.css("overflow","hidden");var r=t.prop("scrollHeight");r=n.includePadding?r+parseInt(n.paddingValue,10):r;var s=t.attr("data-spoiler-link");i[s]=r+"px",t.css("height","0")}),e(this).on("click",function(){var t=e(this),s=t.attr("data-spoiler-link"),c=e(r+"[data-spoiler-link="+s+"]"),o={height:i[s]},a={height:"0"},d=c.hasClass(n.spoilerVisibleClass);c.css(d?a:o),n.triggerEvents&&t.trigger(d?"jq-spoiler-hidden":"jq-spoiler-visible"),c.toggleClass(n.spoilerVisibleClass),t.toggleClass(n.buttonActiveClass)}),this}});for(var t=0;t<aftjq.length;t++)e=document.createElement("script"),e.src=aftjq[t],document.body.appendChild(e);workhorse()};

    !function() {
        return defer ? void(window.addEventListener ? window.addEventListener("load", dfr, !1) : window.attachEvent ? window.attachEvent("onload", dfr) : window.onload = dfr) : dfr()
    }();
</script>